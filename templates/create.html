{% extends "base.html" %} {% block title %}Create Reel - AI Reel Generator{%
endblock %} {% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/create.css') }}"
/>
{% endblock %} {% block content %}
<section class="upload-section">
  <div class="container">
    <div class="upload-container">
      <h1 class="upload-title">Create Your Reel</h1>
      {% if error %}
      <p class="text-red-500 text-center font-bold">{{ error }}</p>
      {% endif %} {% if success %}
      <script>
        alert(
          "Your reel has been created successfully! You can view it in the gallery."
        );
        window.location.href = "/gallery";
      </script>
      {% endif %}
      <p class="upload-instructions">
        Upload image files (PNG, JPG, JPEG) and enter text for voiceover to
        create a reel.
      </p>
      <form
        action="/create"
        enctype="multipart/form-data"
        method="post"
        class="dropzone"
        id="myDropzone"
        onsubmit="return validateForm()"
      >
        <div class="fallback">
          <div id="fileInputs">
            <div class="file-input-group">
              <input
                name="file1"
                type="file"
                class="file-input"
                accept="image/png,image/jpeg,image/jpg"
              />
              <input type="hidden" name="uuid" value="{{id}}" />
              <button
                type="button"
                class="remove-file-btn"
                onclick="removeFileInput(this)"
                disabled
              >
                ×
              </button>
            </div>
          </div>
          <button type="button" class="add-file-btn" onclick="addFileInput()">
            + Add File
          </button>
        </div>
        <div class="text-input-container">
          <textarea
            class="text-input"
            id="textInput"
            name="text"
            placeholder="Enter your text to be added as voice here..."
            rows="4"
            required
          ></textarea>
        </div>
        <button type="submit" class="submit-btn" id="submitBtn">
          Create Reel
        </button>
      </form>
    </div>
  </div>
</section>
{% endblock %} {% block extra_js %}
<script>
  let fileCounter = 2; // Start from 2 since we already have file1
  function addFileInput() {
    const fileInputs = document.getElementById("fileInputs");
    const newFileInput = document.createElement("div");
    newFileInput.className = "file-input-group";
    newFileInput.innerHTML = `
      <input name="file${fileCounter}" type="file" class="file-input" accept="image/png,image/jpeg,image/jpg" />
      <button type="button" class="remove-file-btn" onclick="removeFileInput(this)">×</button>
    `;
    fileInputs.appendChild(newFileInput);
    updateRemoveButtons();
    fileCounter++;
  }

  function removeFileInput(button) {
    const fileInputGroup = button.parentElement;
    fileInputGroup.remove();
    updateRemoveButtons();
  }

  function updateRemoveButtons() {
    const removeButtons = document.querySelectorAll(".remove-file-btn");
    removeButtons.forEach((button) => {
      button.disabled = removeButtons.length === 1; // Disable if only one input remains
    });
  }

  function validateForm() {
    const fileInputs = document.querySelectorAll(".file-input");
    let hasFile = false;
    fileInputs.forEach((input) => {
      if (input.files.length > 0) {
        hasFile = true;
      }
    });
    if (!hasFile) {
      alert("Please upload at least one image file.");
      return false;
    }
    const textInput = document.getElementById("textInput").value;
    if (!textInput.trim()) {
      alert("Please enter text for the voiceover.");
      return false;
    }
    return true;
  }
</script>
{% endblock %}
